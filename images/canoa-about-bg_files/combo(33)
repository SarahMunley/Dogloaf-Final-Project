YUI.add("photo-list-photo-interaction-view",function(e,t){var n=require("lib/helpers/type-validator"),r=require("lib/flog")(t);"use strict";var i=300,s={css:{faveClickArea:".fave-area",commentClickArea:".comment-area",removeFaveTool:"remove-fave",removePoolTool:"remove-group-pool",removeShowCasePhoto:"remove-showcase-photo",removePhotosOfYou:"remove-photosof-you",scotchTool:"scotch-photo"}},o=50,u=20,a=12,f=20;e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=this.appContext.getViewer();return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),(!t.signedIn||e.nsid!==t.nsid)&&this.set("viewingSelf",!1),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),this.params=e,this},loadState:function(){var t=[],n=this.get("listModelParams");return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),n&&t.push(this.appContext.getModel(n.registryName,n.modelIdOrAttributes)),e.Promise.all(t).then(function(e){var t=e[0],n=e[1];this.set("engagement",t),this.extraFunctionality={moreMenuItems:[]},this.params.removeOwnFaves?this.get("model").getValue("isOwner")&&!this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removeFaveTool):this.params.removePoolPhoto?this.get("model").getValue("isOwner")?this.extraFunctionality.removeToolClass=s.css.removePoolTool:n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&(this.extraFunctionality.removeToolClass=s.css.removePoolTool):this.params.scotch?this.extraFunctionality.removeToolClass=s.css.scotchTool:this.params.removeShowCasePhoto?this.get("model").getValue("isOwner")&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removeShowCasePhoto):this.params.removePhotosOfYou&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removePhotosOfYou),this.params.excludePeople&&this.extraFunctionality.moreMenuItems.push("exclude-people"),this.params.banUser&&n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("ban-user"),this.params.removeUser&&n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("remove-user"),this.params.searchSimilar&&this.extraFunctionality.moreMenuItems.push("search-similar"),this.params.searchSimilarWithTerm&&this.extraFunctionality.moreMenuItems.push("search-similar-with-term"),this.params.bigScotch&&(this.extraFunctionality.bigScotchTitle=this.godMessage({intlName:"explore.DO_BIG_SCOTCH"})),this.extraFunctionality.moreMenuItems=this.extraFunctionality.moreMenuItems.join(",")}.bind(this))},buildContainer:function(t){var n=this.get("engagement"),r=n.getValue("faveCount"),i=n.getValue("isFaved"),s=n.getValue("canFave"),l=n.getValue("commentCount"),c=18,h=8,p=17,d=c*2+h*2+p,v=!0,m=!0,g,y=!0,b=!0;return r>=100?d+=o:r>=10?d+=u:r>0&&(d+=a),g=d-c,l>=100?d+=o:l>=10?d+=u:l>0&&(d+=a),this.get("layoutWidth")-d<f&&(v=!1),this.get("layoutWidth")<=d&&(m=!1),this.get("layoutWidth")<=g&&(y=!1),this.get("layoutWidth")<=c+6&&(b=!1),t=t||{},r=y?e.flutil.formatNumbers(r):null,l=e.flutil.formatNumbers(l),t.photo=this.get("model").toJSON(),t.photoPageUrl=this.get("photoPageUrl"),t.faveCount=r,t.isFaved=i,t.canFave=s,t.commentCount=l,t.displayTitleAndAttribution=v,t.displayComments=m,t.displayFaveIcon=b,t.isNarrow=!m&&!y,t.hasExtraFunctionality=Object.keys(this.extraFunctionality).length>0,t.removeToolClass=this.extraFunctionality.removeToolClass,t.moreMenuItems=this.extraFunctionality.moreMenuItems,t.bigScotchTitle=this.extraFunctionality.bigScotchTitle,this.setContainerWithTemplate("photo-list-photo-interaction",t),this},activate:function(){var e=this.appContext.getViewer(),t=this.get("engagement"),n=this.get("container");return this.get("engagement").getValue("canFave")&&(this.registerEventHandler(t.on("valuesChanged",this.faveStarChanged.bind(this))),this.registerEventHandler(n.delegate("click",this.faveStarClicked.bind(this),s.css.faveClickArea))),this.signedOutTest&&(!e||!e.signedIn)&&this.registerEventHandler(n.delegate("click",this.commentClicked.bind(this),s.css.commentClickArea)),this},commentClicked:function(t){var n=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"}),i,s=this.get("engagement"),o,u=this;t.halt(),e.rapidTracker.beacon(u.name,"commentIconClick"),o=e.url(e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("ownerNsid")})),i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-comment",signUpTitle:n,signUpMessage:r,beaconPrefix:"comment"}),i.on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("comment",{postLoginUrl:o})}),i.on("signInClick",function(t){e.SigninHelper._redirectToSignin("comment",{postLoginUrl:o})}),i.show()},showSignUpAndFaveModal:function(t,n){var r=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),i=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),s;s=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:r,signUpMessage:i,beaconPrefix:"fave"}),s.on("signUpClick",function(r){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:n})}),s.on("signInClick",function(r){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:n})}),s.show()},faveStarClicked:function(t){var n=this.appContext.getViewer(),r=this.get("engagement"),i=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),s=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),o=this.intlMessage({intlName:"common.CANCEL"}),u,a,f,l=this;t.halt(),e.rapidTracker.beacon(this.name,"faveButtonClick");if(n&&n.signedIn)this.get("isFaving")||(this.set("isFaving",!0),r.
toggleFave(),r.remoteUpdate().then(function(){this.appContext.getModelRegistry("favorite-models").then(function(e){e.proxy(n.nsid).getValue("photoPageList").remove(l.get("model"))}),this.set("isFaving",!1)}.bind(this),function(e){e.code!==3&&r.toggleFave(),this.set("isFaving",!1)}.bind(this)));else{a=r.getValue("id"),f=e.url(e.URLHelper.getPhotoPage({photoId:a,pathAlias:r.getValue("ownerNsid")}));if(this.signedOutTest)return this.showSignUpAndFaveModal(a,f);u=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:i,actionButtonLabel:s,cancelButtonLabel:o}),u.on("actionClick",function(){e.rapidTracker.beacon(l.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:a},{postLoginUrl:f})}),u.on("cancelClick",function(t){e.rapidTracker.beacon(l.name,"faveModalCancelClick")}),u.show()}t.halt()},faveStarChanged:function(e){(e.faveCount!==undefined||e.isFaved!==undefined||e.canFave!==undefined)&&this.buildContainer()},destructor:function(){}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return n.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},viewingSelf:{value:!0},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,n){return e.AttributeHelpers.validateString(t)}},layoutWidth:{validator:function(t,n){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||undefined},defaultFn:function(e){return 0}},isFaving:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-interaction","attribute-helpers","fluid-modal-view","fluid-droparound-view","url"],optionalRequires:["fluid"],langBundles:["fave-view","common","photo-page-scrappy"]});
YUI.add("attribution-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.hideFollowView}}},initializer:function(e){return this.nsid=e.nsid,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.realFullscreen=!!e.realFullscreen,this.hideFollowView=e.hideFollowView?e.hideFollowView:!1,this.isAlbumView=e.isAlbumView,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("person-models",t.nsid)]).then(function(e){t.set("owner",e[0])})},buildContainer:function(){var e=this.get("owner"),t=this.get("container"),n=e.getValue("pathAlias")||e.getValue("nsid"),r,i=this;return this.albumPhotoListLayoutStyle==="justified"&&t.addClass("justified-album-details-page"),r=e.getValue("buddyicon").large?e.getValue("buddyicon").large:e.getValue("buddyicon")["default"],this.setContainerWithTemplate("attribution",{isPro:i.appContext.flipper.isFlipped("enable-pro-badge")?e.getValue("isPro"):!1,pathAlias:n,buddyicon:r,nsid:e.getValue("nsid"),displayname:e.getValue("displayname"),realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode(),isAlbumView:this.isAlbumView}),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-attribution","promise","follow-view"],optional:["person-models"],langBundles:["attribution"]});
YUI.add("album-header-view",function(e,t){var n=require("lib/flog")(t),r=.8,i=480,s=60,o={css:{headerContent:".album-header-content"}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"album-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-stats-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,hideFollowView:!0,additionalViewClasses:["album-attribution"],isAlbumView:!0}},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("set-models",this.albumId)),this.appContext.getViewer().signedIn&&n.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid)),e.Promise.all(n).then(function(e){t.set("albumModel",e[0]),e[1]&&t.set("personPreferenceModel",e[1])})},buildContainer:function(){var e,t=this.get("container"),i=this.getAlbumHeaderHeight()-s,o=this.get("albumModel"),u=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===o.getValue("owner").id,a=this.appContext.viewportData.getDevicePixelRatio();return this.albumPhotoListLayoutStyle==="justified"&&(t.addClass("justified-transitions"),t.addClass("justified"),i=300),e=o.registry.getSizeToFit(this.albumId,{width:this.appContext.viewportData.getWidth()*r*a,height:i*a}),e||n.error("Failed to load album coverphoto."),this.setContainerWithTemplate("album-header",{height:i,"cover-photo-url":e?e.url:"",viewerIsOwner:u}),this},buildErrorContainer:function(){},activate:function(){var t=this,n=this.get("container"),r=n.one(".edit-cover-photo"),i=n.one(".album-header-content"),u=n.one(".avatar"),a,f=this.get("personPreferenceModel");this.albumHeaderElement=this.get("container").one(o.css.headerContent),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.resizeHeader.bind(this))),r&&this.registerEventHandler(r.on("click",this.handleSetCoverPhotoClick.bind(this)));if(this.appContext.flipper.isFlipped("enable-change-album-sorting")){var l=this.get("container").one(".change-album-sorting");l&&this.registerEventHandler(l.on("click",this.handleChangeAlbumSorting.bind(this)))}e.on("albumToolbarView:layoutChange",function(r){f&&(f.setValues({albumViewLayoutPref:r}),f.remoteUpdate()),r==="justified"?(n.addClass("justified-transitions"),n.addClass("justified"),i.setStyle("height",300),u&&e.flutil.onTransitionEnd(u,function(){n.one(".album-attribution").addClass("justified-album-details-page")})):(a=t.getAlbumHeaderHeight()-s+"px",i.setStyle("height",a),n.removeClass("justified"),u&&setTimeout(function(){n.one(".album-attribution").removeClass("justified-album-details-page")},250),e.flutil.onTransitionEnd(i,function(){n.removeClass("justified-transitions")}))})},onSubviewEvent:function(e,t){var n=this.get("container"),r=n.one(".album-header-content"),i=n.one(".edit-cover-photo");if(e==="album-title-desc-view"&&t[0]==="albumTitleDesc:editing")return this.fire("parentViewEvent","albumHeaderView:editing"),i.addClass("hidden"),!1;if(e==="album-title-desc-view"&&t[0]==="albumTitleDesc:doneEditing")return this.fire("parentViewEvent","albumHeaderView:doneEditing"),i.removeClass("hidden"),!1;e==="album-title-desc-view"&&t[0]==="albumTitleDescEditing:heightChange"&&t[1]&&r.setStyle("height",parseInt(r.getComputedStyle("height"),10)+t[1]+"px")},resizeHeader:function(e){var t=this.getAlbumHeaderHeight()-s,n=this.get("container");n.hasClass("justified")||this.albumHeaderElement.setStyle("height",t)},getAlbumHeaderHeight:function(){var e=this.appContext.viewportData.getWidth(),t=this.appContext.viewportData.getHeight()-50,n=1.3,r=2.3,s=2.75,o=120,u=e/n+o,a=e/r+o,f=e/s,l;return t>u?l=e/n:t>a?l=t-o:t>f?l=t-o+o*(t-a)/(f-a):l=t,Math.max(i,Math.round(l))},handleChangeAlbumSorting:function(t){if(!this.appContext.flipper.isFlipped("enable-change-album-sorting"))return;t.halt();var n=this;this.sortingOptionsDialog=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target,minVerticalSpace:250,positionFixed:!0,anchorOffsetHorizontal:14,menuItems:[{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_NEWEST"}),value:"date-posted-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_OLDEST"}),value:"date-posted-desc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_OLDEST"}),value:"date-taken-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_NEWEST"}),value:"date-taken-desc"},{text:this.intlMessage({intlName:"album-page.SORT_ALPHABETICALLY"}),value:"title"},{text:this.intlMessage({intlName:"album-page.SORT_RANDOMLY"}),value:"random"},{text:this.intlMessage({intlName:"album-page.SORT_REVERSE"}),value:"reverse"}]}),this.registerEventHandler(this.sortingOptionsDialog.on("selected",function(t){t.preventDefault(),n.sortingOptionsDialog.close();if(t.menuItem&&t.menuItem.value){var r={photoset_id:n.get("albumModel").getValue("id"),sort:t.menuItem.value,preview:0};n.loadingModal=new e.Views.FluidModal({appContext:this.appContext,title:n.intlMessage({intlName:"common.LOADING"}),message:n.intlMessage({intlName:"album-page.SORT_ALMOST_DONE"}),showButtons:!1}),n.loadingModal.show(),n.appContext.callAPI("flickr.photosets.sortPhotos",r).then(n.onAlbumSortingChanged.bind(n)).catch(n.onAlbumSortingFailed.bind(n))}})),this.sortingOptionsDialog.show()},onAlbumSortingChanged:function(t){t.stat==="ok"?e.config.win.location.reload():this.onAlbumSortingFailed(t)},onAlbumSortingFailed:function(t){if(t.stat==="fail"){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:"Error while changing sort",actionButtonLabel:this.intlMessage
({intlName:"common.OK"}),showCancelButton:!1});n.show()}},handleSetCoverPhotoClick:function(t){t.preventDefault();var n=this.get("container"),i=this,o=this.get("albumModel"),u=this.templates("flickr-balls")({}),a=n.one(".edit-cover-photo"),f,l,c,h=this.appContext.viewportData.getDevicePixelRatio();f=new e.Views.FluidModal({appContext:i.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:i.appContext,links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],enableSearch:!0}),actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!0,subview:new e.Views["photo-selector-view"]({appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1},defaultSelected:{id:i.albumId,title:i.get("albumModel").getValue("title"),type:"set"}}),width:752,height:498,fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1}),f.on("actionClick",function(t){a.replace(u);var p=f.get("subview").get("selected");this.appContext.getModel("photo-models",p).then(function(e){return o.hasPhoto(p)===!1?c=o.registry.remote.addPhoto({setID:i.albumId,photoID:p},i.appContext).then(function(){return i.fire("subviewViewEvent","newPhotoAddedToAlbum",p),o.registry.remote.setPrimaryPhoto({photoId:p,albumId:i.albumId},i.appContext)}):c=o.registry.remote.setPrimaryPhoto({photoId:p,albumId:i.albumId},i.appContext),c.then(function(t){l=e.getSizeToFit({width:i.appContext.viewportData.getWidth()*r*h,height:(i.getAlbumHeaderHeight()-s)*h}),o.setValue("primary",e.id),o.setValue("primaryPhotoSizes",e.getValue("sizesForAlbum")),o.setValue("primaryNeedsInterstitial",e.getValue("needsInterstitial")),l&&n.one(".album-header-content").setStyle("background-image","url("+l.url+")"),n.one(".balls").replace(a)})}).then(null,function(t){var r=new e.Views.FluidModal({title:i.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),textMessage:i.intlMessage({intlName:"album-page.ERROR_COVER_PHOTO"}),appContext:i.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0});r.show(),n.one(".balls").replace(a)})}),f.registerEventHandler(e.on("photoSelector:selected",function(e){f.enableActionButton()})),f.registerEventHandler(e.on("photoSelector:unselected",function(e){f.disableActionButton()})),e.rapidTracker.beacon(i.name,"albumCoverPhotoEdit"),f.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-header","hermes-template-flickr-balls"],optional:["album-title-desc-view","album-stats-view","album-engagement-view","photo-selector-view","fluid-modal-nav-bar-view","photo-list-photo-interaction-view","attribution-view"],langBundles:["album-page","global-nav","common"]});
YUI.add("album-page-view",function(e,t){var n=require("lib/flog")(t),r=190,i=430,s=null,o=3;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.albumId=t.albumId,this.isOwner=t.isOwner,this.isTwitterbot=t.isTwitterbot,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,t.id=t.albumId,t.modelRegistryName="set-models",t.maxNumAttrName="totalCount",this.pageParams=t.pageParams,t.photoListConfig={modelParams:{registryName:"set-models",modelIdOrAttributes:t.albumId,collectionAttributeName:"photoPageList"},parentName:this.name,pageParams:t.pageParams,contextSuffix:"album-"+t.albumId,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:t.withPhotoId},t.photoListConfig.layout={targetRowHeight:this.albumPhotoListLayoutStyle==="justified"?r:i,fullWidthBreakoutRowCadence:this.albumPhotoListLayoutStyle==="justified"?s:o,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:4,right:0,bottom:4,left:0},itemSpacing:{horizontal:4,vertical:4}},this.aftHelper=new e.PhotolistAftHelper(this),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"album-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,disabled:function(){return!this.pageParams.viewPageSize}},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("set-models",this.albumId).then(function(t){e.set("albumModel",t)})},buildContainer:function(){return this.setContainerWithTemplate("album-page"),this},buildHeadContainer:function(){var t=this.get("albumModel"),r=t.getValue("photoPageList").getList(),i="summary",s=[],o,u=(this.pageParams.nominalPage-1)*this.pageParams.viewPageSizeForShare||0,a,f,l;if(this.isTwitterbot&&r.length-u>=4){i="gallery";for(f=0;f<Math.min(r.length-u,4);f++)if(r[u+f]){var c=r[u+f].getSizeToFit({width:640,height:640});c&&c.url&&s.push({property:"twitter:image"+f,content:c.url})}else n.error("Missing album photo in album list",{index:u+f})}t.registry?o=t.registry.getSizeToFit(this.albumId,{width:640,height:640}):n.error("Missing album model registry"),l=t.getValue("url").replace(/\/albums\/([0-9]+)/i,"/sets/$1"),a=this.templates("dynamic-page-head")({title:t.getValue("title"),description:t.getValue("description")||this.intlMessage({intlName:"album-page.OPENGRAPH_DESCRIPTION",owner:t.getValue("owner").getValue("displayname")}),url:t.getValue("url"),fullURL:e.url(l),openGraphImageURL:o?e.URLHelper.addProtocolToURL(o.url):"",openGraphaImageWidth:o?o.width:"",openGraphaImageHeight:o?o.height:"",ownerURL:t.getValue("owner").getValue("url"),twitterCardType:i,twitterImages:s,ogType:"article",domain:e.url()}),a+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),a+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, initial-scale=1, maximum-scale=1"}),a+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",a):(this.set("headContainer",a.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},activate:function(){var t=this,n=this.get("albumModel"),u=n.getValue("isOwner");return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),e.on("albumToolbarView:layoutChange",function(e){var n=t.subviews["photo-list-view"],u=n.photoListLayout;u.targetRowHeight=e==="justified"?r:i,u.fullWidthBreakoutRowCadence=e==="justified"?s:o,n.setItems(t.get("albumModel").getValue("photoPageList").getList())}),u||this.appContext.getViewCounter().recordAlbumView({albumOwnerID:n.getValue("owner").getValue("id"),albumID:n.getValue("id"),referrer:this.appContext.getReferrer()}),this},onSubviewEvent:function(e,t){t&&t[0]==="newPhotoAddedToAlbum"&&this.subviews["photo-list-view"].setItems(this.get("albumModel").getValue("photoPageList").getList())},getTrackingSegments:function(){return{vwrOwner:this.isOwner?1:0}}},{ATTRS:{spaceid:{value:792600538}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","set-models","hermes-template-album-page","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-head-link","album-toolbar-view","album-header-view","photo-list-view","footer-full-view","photolist-aft-helper","url-helper"],langBundles:["album-page"]});
